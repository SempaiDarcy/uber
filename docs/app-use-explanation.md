# Express: Что делает `app.use()`

## Основная идея

`app.use()` — это метод Express, который подключает middleware или router.  
Он говорит серверу:

> Когда придёт запрос, используй эту функцию (или группу функций),  
> чтобы что-то сделать с запросом или ответом перед тем, как он дойдёт до конечного обработчика.

---

## Простое объяснение

`app.use()` позволяет Express работать с данными между слоями —  
между моментом, когда запрос пришёл, и моментом, когда сервер на него ответил.

---

## Примеры использования

### 1. Middleware для JSON
```ts
app.use(express.json());
```

Перед обработкой запроса Express автоматически разбирает тело запроса (`req.body`),  
если оно отправлено в формате JSON.  
Без этого `req.body` будет `undefined`.

---

### 2. Подключение router
```ts
app.use('/drivers', driversRouter);
```

Все запросы, начинающиеся с `/drivers`, будут передаваться в `driversRouter`,  
где описаны маршруты, связанные с водителями.

Примеры маршрутов:
- `GET /drivers`
- `POST /drivers`
- `GET /drivers/:id`

---

### 3. Собственный middleware
```ts
app.use((req, res, next) => {
  console.log(req.method, req.url);
  next();
});
```

Такой middleware выполняется при каждом запросе.  
Он может использоваться для логирования, авторизации, валидации и других общих операций.  
Функция `next()` передаёт управление следующему обработчику в цепочке.

---

## Почему это важно

Middleware — это цепочка слоёв, через которые проходит запрос.  
Каждый слой может:
- изменить запрос или ответ (`req`, `res`);
- прервать выполнение и отправить ответ сразу;
- или передать управление дальше через `next()`.

---

## Краткое сравнение

| Что делает `app.use()` | Пример | Назначение |
|------------------------|---------|-------------|
| Подключает middleware | `app.use(express.json())` | Позволяет работать с JSON-телом |
| Подключает router | `app.use('/users', usersRouter)` | Делит API на модули |
| Обрабатывает все запросы | `app.use((req,res,next)=>{})` | Общая логика до маршрутов |

---

## Итог

`app.use()` — это инструмент, который соединяет слои приложения,  
позволяя Express последовательно обрабатывать запросы.  
Он делает возможным разделение логики, валидацию, логирование, авторизацию и маршрутизацию.
